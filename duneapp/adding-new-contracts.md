---
说明: >-
  你应该知道的关于成功解码新合约的全部提交过程
---

# 添加新合约

Dune包含了大量的[调用和事件表](../data-tables/data-tables/decoded-data.md#decoded-smart-contract-data)形式的解码合约，这些合约通常经过[解码](../data-tables/data-tables/decoded-data.md)的过程来到Dune中。

## 快速浏览

{% embed url="https://www.youtube.com/watch?v=4v9zEYZvv34" %}

## 提交一个新的合约

解码一个新的合约可以通过提交新合约表格，在 [我的创作> 合约](https://dune.xyz/browse/contracts/authored) 或在查询编辑器的侧边栏的数据集探索器中访问：

![](<../.gitbook/assets/Screen Shot 2022-01-03 at 15.46.22.png>)

点击那里将弹出一个新的浏览器标签，上面有合同提交表，其中包括2个步骤：

### 1. 区块链和地址

我们首先要提供合约的地址和所在链。首先要求这些数据有两个目的：预测潜在的重复合约和待提交的合约，以及在可以的情况下尽量将提交过程的一部分自动化。后者通常是通过从Dune或其他相关的第三方数据源获取潜在的有用元数据来实现的。

例如，下面我们用提交Optimism上的USDT合约 (`0x94b008aA00579c1307B0EF2c499aD98a8ce58e58`)：

![](<../.gitbook/assets/Screen Shot 2022-01-03 at 16.02.19.png>)

如果我们能通过第三方来源找到合约，我们会在地址栏旁边显示一个绿色的复选标记。这意味着我们能够获取合同的名称和ABI。&#x20;

### 2. 合约细节

接下来在点击 "下一步 "后，会提示你提供我们需要的关于合约的其他信息，以便对其进行解码：

![](<../.gitbook/assets/Screen Shot 2022-01-03 at 16.05.07.png>)

如果我们通过其他第三方来源找到了合约，你只需要填上项目名称。我们对此有一些命名惯例，部分是由于我们的技术设置，也是为了使寻找数据更有预见性。

一旦你提交了它，就完成了! 合约将被储存在我们的队列中，为了保证质量，我们会人工审查。你的提交可能需要几天的时间才能得到处理。

### 高级选项

在某些情况下，Dune可以自动检测和索引同一提交下的多个合约地址。这对于像AMM池这样的例子很有用，一个合约地址对应一个代币对。

我们有两种策略来检测其他合同进行解码：

1. **字节码匹配。** 我们使用提交的合约地址的字节码在整个链的历史中寻找与之匹配的。
   
2. **工厂实例。** 我们找到与负责创建提交的合约的地址相同的所有其他合约。

在这两种情况下，我们认定通过这两种方法找到的所有合约都对应于同一个区块链、项目名称、合约名称和ABI。

如果你想让我们索引一个以上的合同，请切换到高级选项，对第一个问题选择 "是"。然后，对于 "它是由工厂合同创建的吗？"的问题，选择 "否 "来索引所有其他具有相同字节码的合同，或者选择 "是 "来索引所有其他源于同一创建者的合约。

{% hint style="warning" %}
只有在你清楚你在做什么，并且非常熟悉项目的架构和部署层次的情况下，才能使用这些选项。&#x20;

不正确地应用这些设置可能导致提交被拒绝。
{% endhint %}

## 追踪你的提交

你可以在任何时候通过浏览[我的创作 > 合约]来查看你的提交和他们的处理状态。(https://dune.xyz/browse/contracts/authored):

![](<../.gitbook/assets/Screen Shot 2022-01-03 at 14.43.07.png>)

## 常见的问题

### 手动提交合约信息

尽管我们试图获取合同信息，如ABI，但有时这些信息可能无法通过我们的来源获得。&#x20;

这种情况下，你需要手动输入合约的名称和它的ABI。如果合约在[Etherscan](http://etherscan.io/)或[Blockscout](https://blockscout.com/)等区块浏览器中得到验证，那么这些信息应该可以得到。

{% hint style="info" %}
如果手动提交的合约是一个代理合约，我们建议你进入下一节。
{% endhint %}

### 提交代理合约

为了对符合Proxy模式的合同进行正确的交易解码，Dune需要将Proxy合同的地址与实现合同的ABI进行映射。&#x20;

我们避免监控合约地址的实现，因为它的逻辑是通过使用事务中的Delegatecall来访问的。这会导致我们错过实现合约逻辑中的任何事件日志，因为这些事件实际上是由调用者（本例中的代理）在通过Delegatecall调用一个函数时触发。

**在向Dune提交代理合约时，你应该输入代理合约的地址。** 然后我们将尝试获取代理的合约名称和它所指向的实现地址。之后，我们将尝试获取实现合约的ABI来源。

{% hint style="info" %}
为了正确解码一个代理合约，Dune需要**代理地址** and the **实现ABI**.
{% endhint %}

### 重新提交一个合约

Dune认为区块链中的每个地址最多可以映射到1个合约。出于这个原因，提交一个地址已经存在于“ethereum.contracts”中的合约，将为解码目的覆盖它会有几个潜在的危险：

* 如果项目或合约名称已经改变，我们将为合约的所有方法和事件生成新的表格。反过来，以前的表将停止更新，数据将被分割，查询将停止工作。
* 如果ABI发生了变化导致现有表的参数变化，依赖该表的查询可能会中断或变得不准确。

如果你想提交一个已经存在的合约，请确保提交的内容包含额外的前后文，这样我们可以评估是否值得覆盖合约的数据。&#x20;

有时接受重新提交的风险高于我们认为的价值，就会被拒绝。如果你不同意，请随时与我们联系，在Dune Discord的#decoding，我们会看看我们能做什么。

### 钻石代理合同的解码

与普通的代理合约类似[EIP-2535](https://eips.ethereum.org/EIPS/eip-2535)合约可以通过传入钻石代理的地址以及**一个代表所有接口的ABI来支持**.

### 我的提交为什么被拒绝了？

为了保证数据质量，我们拒绝重复的、不正确的或低质量的提交。为了避免这种情况，请确保提交准确的合约信息。

### 其他问题

请到我们[Discord](https://discord.gg/ErrzwBz)的#decodingand来，我们很乐意提供帮助！
